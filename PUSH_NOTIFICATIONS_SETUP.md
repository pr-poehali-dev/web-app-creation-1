# Настройка Push-уведомлений

## Генерация VAPID ключей

Для работы push-уведомлений необходимо сгенерировать пару VAPID ключей.

### Шаг 1: Установите web-push (если еще не установлен)

```bash
npm install -g web-push
```

### Шаг 2: Сгенерируйте ключи

```bash
npx web-push generate-vapid-keys
```

Вы получите вывод примерно такого вида:

```
=======================================
Public Key:
BNXMlWWe8xvXP5QO5vJ7MQ8OZYhQq8Bv3QvNdxZ_8G5dPPLGxq3Mz1yL8VzZz1Xx5QBv8LvL9z3Qz8QvZvZQzZz

Private Key:
xJQYhR8pZ6vL9wZ3Qz8QvZvZQzZzBNXMlWWe8xvXP5QO
=======================================
```

### Шаг 3: Добавьте ключи в систему

1. **Публичный ключ (VAPID_PUBLIC_KEY)**:
   - Скопируйте Public Key
   - В интерфейсе poehali.dev добавьте его в секреты проекта
   - Также замените в файле `src/services/pushNotifications.ts` строку 1:
     ```typescript
     const PUBLIC_VAPID_KEY = 'ВАШ_ПУБЛИЧНЫЙ_КЛЮЧ';
     ```

2. **Приватный ключ (VAPID_PRIVATE_KEY)**:
   - Скопируйте Private Key
   - В интерфейсе poehali.dev добавьте его в секреты проекта
   - Этот ключ используется в backend функции `push-send`

### Шаг 4: Пересоберите проект

После добавления публичного ключа в код пересоберите frontend:

```bash
npm run build
```

## Как это работает

1. **Регистрация**: После регистрации пользователю предлагается включить уведомления
2. **Подписка**: Браузер подписывается на push-уведомления через Service Worker
3. **Сохранение**: Данные подписки сохраняются в БД (таблица `push_subscriptions`)
4. **Отправка**: При откликах на запросы/предложения автоматически отправляются уведомления

## Управление уведомлениями

Пользователи могут управлять уведомлениями в:
- Профиль → Push-уведомления

## События, вызывающие уведомления

- ✅ Отклик на предложение пользователя
- ✅ Отклик на запрос пользователя

## Backend функции

- `push-subscribe` (4ff79524-ce04-4dc8-aeb9-d4030c140d66) - управление подписками
- `push-send` (d84dd37e-ac91-473e-a3a8-5cf34f66c9b5) - отправка уведомлений

## Поддержка браузеров

- ✅ Chrome/Edge (Desktop & Android)
- ✅ Firefox (Desktop & Android)
- ✅ Safari (macOS 16.4+, iOS 16.4+)
- ❌ iOS Safari < 16.4
